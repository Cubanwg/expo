{"version":3,"file":"index.js","names":["dotenv","data","_interopRequireWildcard","require","_dotenvExpand","_getenv","_nodeConsole","_interopRequireDefault","_nodeFs","_nodePath","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","debug","isEnabled","boolish","KNOWN_MODES","exports","LOADED_ENV_NAME","getEnvFiles","mode","process","env","NODE_ENV","silent","logError","console","error","logWarning","warn","includes","filter","Boolean","parseEnvFiles","envFiles","systemEnv","files","loadedEnvVars","loadedEnvFiles","reverse","forEach","envFile","envFileContent","fs","readFileSync","envFileParsed","parse","push","key","keys","code","expandEnvFromSystem","loadEnvFiles","force","result","loaded","JSON","parsed","loadedEnvKeys","stringify","parsedEnv","expandedEnv","allExpandedEnv","dotenvExpand","processEnv","parseProjectEnv","projectRoot","options","map","path","join","loadProjectEnv"],"sources":["../src/index.ts"],"sourcesContent":["import * as dotenv from 'dotenv';\nimport { expand as dotenvExpand } from 'dotenv-expand';\nimport { boolish } from 'getenv';\nimport console from 'node:console';\nimport fs from 'node:fs';\nimport path from 'node:path';\n\nconst debug = require('debug')('expo:env') as typeof console.log;\n\n/** Determine if the `.env` files are enabled or not, through `EXPO_NO_DOTENV` */\nexport function isEnabled() {\n  return !boolish('EXPO_NO_DOTENV', false);\n}\n\n/** All conventional modes that should not cause warnings */\nexport const KNOWN_MODES = ['development', 'test', 'production'];\n\n/** The environment variable name to use when marking the environment as loaded */\nexport const LOADED_ENV_NAME = '__EXPO_ENV_LOADED';\n\n/**\n * Get a list of all `.env*` files based on the `NODE_ENV` mode.\n * This returns a list of files, in order of highest priority to lowest priority.\n *\n * @see https://github.com/bkeepers/dotenv/tree/v3.1.4#customizing-rails\n */\nexport function getEnvFiles({\n  mode = process.env.NODE_ENV,\n  silent,\n}: {\n  /** The mode to use when creating the list of `.env*` files, defaults to `NODE_ENV` */\n  mode?: string;\n  /** If possible misconfiguration warnings should be logged, or only logged as debug log */\n  silent?: boolean;\n} = {}) {\n  if (!isEnabled()) {\n    debug(`Skipping .env files because EXPO_NO_DOTENV is defined`);\n    return [];\n  }\n\n  const logError = silent ? debug : console.error;\n  const logWarning = silent ? debug : console.warn;\n\n  if (!mode) {\n    logError(\n      `The NODE_ENV environment variable is required but was not specified. Ensure the project is bundled with Expo CLI or NODE_ENV is set. Using only .env.local and .env`\n    );\n    return ['.env.local', '.env'];\n  }\n\n  if (!KNOWN_MODES.includes(mode)) {\n    logWarning(\n      `NODE_ENV=\"${mode}\" is non-conventional and might cause development code to run in production. Use \"development\", \"test\", or \"production\" instead. Continuing with non-conventional mode`\n    );\n  }\n\n  // see: https://github.com/bkeepers/dotenv/tree/v3.1.4#customizing-rails\n  return [\n    `.env.${mode}.local`,\n    // Don't include `.env.local` for `test` environment\n    // since normally you expect tests to produce the same\n    // results for everyone\n    mode !== 'test' && `.env.local`,\n    `.env.${mode}`,\n    `.env`,\n  ].filter(Boolean) as string[];\n}\n\n/**\n * Parse all environment variables using the list of `.env*` files, in order of higest priority to lowest priority.\n * This does not check for collisions of existing system environment variables, or mutates the system environment variables.\n */\nexport function parseEnvFiles(\n  envFiles: string[],\n  {\n    systemEnv = process.env,\n  }: {\n    /** The system environment to use when expanding environment variables, defaults to `process.env` */\n    systemEnv?: NodeJS.ProcessEnv;\n  } = {}\n) {\n  if (!isEnabled()) {\n    debug(`Skipping .env files because EXPO_NO_DOTENV is defined`);\n    return { env: {}, files: [] };\n  }\n\n  // Load environment variables from .env* files. Suppress warnings using silent\n  // if this file is missing. Dotenv will only parse the environment variables,\n  // `@expo/env` will set the resulting variables to the current process.\n  // Variable expansion is supported in .env files, and executed as final step.\n  // https://github.com/motdotla/dotenv\n  // https://github.com/motdotla/dotenv-expand\n  const loadedEnvVars: dotenv.DotenvParseOutput = {};\n  const loadedEnvFiles: string[] = [];\n\n  // Iterate over each dotenv file in lowest prio to highest prio order.\n  // This step won't write to the process.env, but will overwrite the parsed envs.\n  envFiles.reverse().forEach((envFile) => {\n    try {\n      const envFileContent = fs.readFileSync(envFile, 'utf8');\n      const envFileParsed = dotenv.parse(envFileContent);\n\n      // If there are parsing issues, mark the file as not-parsed\n      if (!envFileParsed) {\n        return debug(`Failed to load environment variables from: ${envFile}%s`);\n      }\n\n      loadedEnvFiles.push(envFile);\n      debug(`Loaded environment variables from: ${envFile}`);\n\n      for (const key of Object.keys(envFileParsed)) {\n        if (typeof loadedEnvVars[key] !== 'undefined') {\n          debug(`\"${key}\" is already defined and overwritten by: ${envFile}`);\n        }\n\n        loadedEnvVars[key] = envFileParsed[key];\n      }\n    } catch (error: any) {\n      // Handle possible ENOENT errors when the env file doesn't exist\n      if ('code' in error && error.code === 'ENOENT') {\n        return debug(`${envFile} does not exist, skipping this file`);\n      }\n\n      throw error;\n    }\n  });\n\n  return {\n    env: expandEnvFromSystem(loadedEnvVars, systemEnv),\n    files: loadedEnvFiles.reverse(),\n  };\n}\n\n/**\n * Parse all environment variables using the list of `.env*` files, and mutate the system environment with these variables.\n * This won't override existing environment variables defined in the system environment.\n * Once the mutations are done, this will also set a propert `__EXPO_ENV=true` on the system env to avoid multiple mutations.\n * This check can be disabled through `{ force: true }`.\n */\nexport function loadEnvFiles(\n  envFiles: string[],\n  {\n    force,\n    systemEnv = process.env,\n  }: Parameters<typeof parseEnvFiles>[1] & {\n    /** If the environment variables should be applied to the system environment, regardless of previous mutations */\n    force?: boolean;\n  } = {}\n) {\n  if (!force && systemEnv[LOADED_ENV_NAME]) {\n    return { result: 'skipped', loaded: JSON.parse(systemEnv[LOADED_ENV_NAME]) };\n  }\n\n  const parsed = parseEnvFiles(envFiles, { systemEnv });\n  const loadedEnvKeys: string[] = [];\n\n  for (const key in parsed.env) {\n    if (typeof systemEnv[key] !== 'undefined') {\n      debug(`\"${key}\" is already defined and IS NOT overwritten`);\n    } else {\n      systemEnv[key] = parsed.env[key];\n      loadedEnvKeys.push(key);\n    }\n  }\n\n  // Mark the environment as loaded\n  systemEnv[LOADED_ENV_NAME] = JSON.stringify(loadedEnvKeys);\n\n  return { result: 'loaded', ...parsed, loaded: loadedEnvKeys };\n}\n\n/**\n * Expand the parsed environment variables using the existing system environment variables.\n * This does not mutate the existing system environment variables, and only returns the expanded variables.\n */\nfunction expandEnvFromSystem(\n  parsedEnv: Record<string, string>,\n  systemEnv: NodeJS.ProcessEnv = process.env\n) {\n  const expandedEnv: Record<string, string> = {};\n\n  // Pass a clone of the system environment variables to avoid mutating the original environment.\n  // When the expansion is done, we only store the environment variables that were initially parsed from `parsedEnv`.\n  const allExpandedEnv = dotenvExpand({\n    parsed: parsedEnv,\n    processEnv: { ...systemEnv } as Record<string, string>,\n  });\n\n  if (allExpandedEnv.error) {\n    console.error(\n      `Failed to expand environment variables, using non-expanded environment variables: ${allExpandedEnv.error}`\n    );\n    return parsedEnv;\n  }\n\n  // Only store the values that were initially parsed, from `parsedEnv`.\n  for (const key of Object.keys(parsedEnv)) {\n    if (allExpandedEnv.parsed?.[key]) {\n      expandedEnv[key] = allExpandedEnv.parsed[key];\n    }\n  }\n\n  return expandedEnv;\n}\n\n/**\n * Parse all environment variables using the detected list of `.env*` files from a project.\n * This does not check for collisions of existing system environment variables, or mutates the system environment variables.\n */\nexport function parseProjectEnv(\n  projectRoot: string,\n  options?: Parameters<typeof getEnvFiles>[0] & Parameters<typeof parseEnvFiles>[1]\n) {\n  return parseEnvFiles(\n    getEnvFiles(options).map((envFile) => path.join(projectRoot, envFile)),\n    options\n  );\n}\n\n/**\n * Parse all environment variables using the detected list of `.env*` files from a project.\n * This won't override existing environment variables defined in the system environment.\n * Once the mutations are done, this will also set a propert `__EXPO_ENV=true` on the system env to avoid multiple mutations.\n * This check can be disabled through `{ force: true }`.\n */\nexport function loadProjectEnv(\n  projectRoot: string,\n  options?: Parameters<typeof getEnvFiles>[0] & Parameters<typeof loadEnvFiles>[1]\n) {\n  return loadEnvFiles(\n    getEnvFiles(options).map((envFile) => path.join(projectRoot, envFile)),\n    options\n  );\n}\n"],"mappings":"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","ignoreList":[]}